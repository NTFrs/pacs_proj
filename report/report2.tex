\documentclass[a4paper,10pt]{article}

\usepackage[utf8]{inputenc}
\usepackage[italian]{babel}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{xfrac}
%opening
\title{Riassunto Progetto Pacs}
\author{Nahuel Foresta, Giorgio Re}

\setlength{\parindent}{0pt}

\newcommand{\der}[2]{\frac{\delta #1}{\delta #2}}
\newcommand{\dder}[2]{\frac{\delta^2 #1}{\delta #2^2}}
\newcommand{\dmix}[3]{\frac{\delta^2 #1}{\delta #2 \delta #3}}
\begin{document}

\maketitle

\section{Riassunto Obiettivi}

Come gi\`a indicato nel primo report, l'obiettivo del progetto è di creare un programma per prezzare una serie di opzioni utilizzando dei metodi basati a elementi finiti. Il valore di un opzione al variare del sottostante (che supponiamo evolvere secondo un modello Jump-Diffusion) può essere in generale trovato come soluzione di un equazione integro differenziale del tipo

\begin{multline}
\der{C}{t}+\frac{\sigma^2}{2}S^2\dder{C}{S}+r\der{C}{S}-rC+\\+ \int_\mathbb{R}\left(C(t,Se^y)-C(t,S)-S(e^y-1)\der{C}{S}(t,S)\right)k(y)dy=0
\end{multline}

su $[0,T]\times[0,+\infty]$ con opportune condizioni al bordo e condizione finale $C(T,S)=g(S)$ payoff dell'opzione. $k$ è un nucleo con una forte massa nell'intorno dello zero e code esponenziali o gaussiane.
In due dimensioni, supponendo l'indipendenza delle componenti di salto dei due sottostanti, tale equazione diventa:


\begin{multline}
 \der{C}{t}+\frac{\sigma_1^2}{2}S_1^2\dder{C}{S_1}+\frac{\sigma_2^2}{2}S_2^2\dder{C}{S_2}+\rho\sigma_1\sigma_2 S_1 S_2 \dmix{C}{S_1}{S_2}+
 r\der{C}{S_1}+r\der{C}{S_2}-rC+ \\
 + \int_\mathbb{R}\left(C(t,S_1e^{y},S_2)-C(t,S_1,S_2)-S_1(e^y-1)\der{C}{S}(t,S_1,S_2)\right)k_1(y)dy\\
 + \int_\mathbb{R}\left(C(t,S_1,S_2e^{y})-C(t,S_1,S_2)-S_2(e^y-1)\der{C}{S}(t,S_1,S_2)\right)k_2(y)dy=0 
\end{multline}
su $[0,T]\times[0,+\infty]^2$ con opportune B.C. e valore finale.

\section{Strumenti Aggiunti rispetto a report 1}

\subsection{Libreria di Integrazione}
Poich\'e le densit\`a all'interno dell'integrale sono del tipo: $$k(y)=p\lambda\lambda_+e^{-\lambda_+x}\mathcal{I}_\{x>0\}+(1-p)\lambda\lambda_-e^{-\lambda_-x}\mathcal{I}_\{x<0\},$$ per il modello di Kou e $$k(y)=\frac{\lambda}{\delta\sqrt{2\pi}}exp\left\{-\frac{(x-\mu)^2}{2\delta^2}\right\}$$ per il modello di Merton, abbiamo usato dei nodi di quadratura che inglobassero gi\`a il peso esponenziale. Sfruttando quindi le funzioni offerte dalla libreria \textsf{legendre\_rule.hpp} utilizzata in uno dei laboratori, abbiamo utilizzato i nodi di Laguerre per calcolare l'integrale con il metodo di Kou (ottenendo risultati pi\`u precisi rispetto a quelli di Gauss), e pensiamo di utilizzare i nodi di Hermite per il modello di Merton.

\section{Cosa è stato fatto}

\subsection{Fino al report precedente}
Al momento dell'ultimo report lo stato era:

\begin{itemize}
 \item Costruito un programma che risolve l'equazione PDE  (senza parte integrale) in una dimensione in un caso semplice utilizzando unicamente gli strumenti forniti dalla libreria.
 \item Abbiamo risolto lo stesso problema nel caso bi-dimensionale. Sebbene il comportamento qualitativo della soluzione è quello aspettato, i valori esatti non sono ancora giusti (confrontati con dei risultati dati da tool che risolvono l'equazione con metodi alle differenze finite).
 \item Abbiamo provato a risolvere l'equazione integro differenziale in una dimensione in diversi modi. In due casi siamo riusciti ad ottenere un risultato corretto, ma non pienamente soddisfacenti.
\end{itemize}

\subsection{Fino ad ora}

Dopo l'ultimo incontro, abbiamo deciso di esplorare sia l'utilizzo di formule di quadrature più adatte per trattare il termine integrale con nucleo esponenziale, sia di utilizzare funzioni della libreria deal II che permettono di valutare la funzione in un punto qualsiasi. In particolare

\begin{itemize}
 \item Abbiamo corretto la PDE in 2D ottenendo il risultato atteso.
 \item Abbiamo implementato la quadratura diretta del termine integrale utilizzando l'equazione nella forma \eqref{eq:costcoeff}, sia in 1D che in 2D. Vedere la sezione \ref{sec:metod} Metodologia per i dettagli.
 \item Abbiamo implementato il calcolo dell'integrale con i nodi di Laguerre per la quadratura del termine integrale con nucleo esponenziale (modello di Kou).
\end{itemize}


\subsection{Metodologia}
\label{sec:metod}
La PDE (e la PIDE) in questione è trasformabile in un equazione a coefficienti costanti con la trasformazione $x_i=\ln{S_i} \; (\text{oppure } x_i=\ln{\sfrac{S_i}{S_i^0}})$ e $C(t,S_1,S_2)=u(t,x_1,x_2)$. In tal caso diventa (2D):
{
\begin{multline}
 \der{u}{t}+\frac{\sigma_1^2}{2}\dder{u}{x_1}+\frac{\sigma_2^2}{2}\dder{u}{x_2}+\rho\sigma_1\sigma_2\dmix{u}{x_1}{x_2}+
 \left(r-\sigma_1^2\right)\der{u}{x_1}
 \left(r-\sigma_2^2\right)\der{u}{x_2}-ru+\\
 +\int_\mathbb{R}\left( u(t,x_1+y,x_2)-u(t,x_1,x_2)-(e^y-1)\der{u}{x_1}\right)k_1(y)dy+\\
 +\int_\mathbb{R}\left( u(t,x_1,x_2+y)-u(t,x_1,x_2)-(e^y-1)\der{u}{x_2}\right)k_2(y)dy=0
 \label{eq:costcoeff}
 \end{multline}
}
Definendo 

\begin{equation*}
 \hat{\lambda_i}=\int_\mathbb{R}u(t,x,y)k_i(y)dy \qquad \hat{\alpha_i}=\int_\mathbb{R}(e^y-1)\der{u}{x_i}k_i(y)dy
\end{equation*}
L'equazione \eqref{eq:costcoeff} diventa: 

{
\small
\begin{multline}
 \der{u}{t}+\frac{\sigma_1^2}{2}\dder{u}{x_1}+\frac{\sigma_2^2}{2}\dder{u}{x_2}+\rho\sigma_1\sigma_2\dmix{u}{x_1}{x_2}+
 \left(r-\sigma_1^2-\hat{\alpha_1}\right)\der{u}{x_1}
 \left(r-\sigma_2^2-\hat{\alpha_2}\right)\der{u}{x_2}+\\-(r+\lambda_1+\lambda_2)u+
 \int_\mathbb{R}u(t,x_1+y,x_2)k_1(y)dy+
 \int_\mathbb{R}u(t,x_1,x_2+y)k_2(y)dy=0
 \label{eq:costcoeff2}
\end{multline}
}

% Per la parte temporale abbiamo utilizzato una discretizzazione differenze finite con schema di eulero implicito o Crank Nicolson, eccetto per la parte integrale che viene trattata esplicitamente e messa nel \emph{rhs}. Tale schema è stabile purché $\Delta t < \sfrac{1}{\hat{\lambda}}$. Gli elementi finiti scelti sono Q1, polinomi lineari sui quadrati, offerti gentilmente dalla libreria deal II. Il dominio su $S$ viene troncato all'intervallo $(S_{min},S_{max})$, opportunamente scelto. 
% \\
% La difficoltà si riduce dunque a integrare $u(t,x+y)k(y)$.

Senza entrare nei dettagli (vedere report1), otteniamo una discretizzazione del tipo:

\begin{equation}
 M_1u^k=M_2u^{k+1}+J^{k+1}  \qquad \text{ per } k=M\dots1 \qquad \text{ e } \qquad u^{M}(S)=g(S) 
\end{equation}

Dove $M_1$ è la somma delle matrici date dagli elementi finiti (stiffnes, etc, etc) e $M_2$ è la matrice di massa divisa per il passo temporale. Dall'ultimo report, ci siamo concentrati su un modo di calcolare il termine esplicito $J$.

\subsection{La parte integrale $J$}

Nell'ultimo report erano spiegati i problemi che il calcolo di questa parte introduce così come due approcci possibili. Ci siamo concentrati sull'approccio che non genera una matrice densa, ma richiede il calcolo del vettore J a ogni iterata temporale.

Riassumendo, si tratta di calcolare nel nodo $x^i=(x_1^i,x_2^i)$ due valori di J: 

\begin{equation*}
 J_1^i=J_1(x^i)=\int_\mathbb{R}u(t,x_1^i+y,x_2^i)k_1(y)dy \text{ e } J_2^i=J_2(x^i)=\int_\mathbb{R}u(t,x_1^i,x_2^i+y)k_2(y)dy
\end{equation*}
nei diversi nodi $x^i$ della griglia. In seguito si potrà scrivere dunque 

\begin{equation*}
 \sum_{j=1}^N J_j\int_{x_{min}}^{x_{max}} \phi_i(x)\phi_j(x)dx
\end{equation*}

scrivibile come $M\underline{J}$, con $M$ matrice di massa, e aggiungere tale termine all'\emph{rhs}.

L'eq da risolvere a ogni passo temporale è dunque:

\begin{equation*}
 M_1u^k=M_2u^{k+1}+M\underline{J}^{k+1}  \qquad \text{ per } k=M\dots1
\end{equation*}


% \begin{equation*}
% \end{equation}
Per calcolare tale integrale è necessario il valore di $u$ sia in punti interni al dominio che non appartengono alla mesh, sia fuori dalla mesh. Per quanto riguarda i punti all'interno della mesh abbiamo usato il 
\subsubsection{Conclusioni parziali e futuri passi}

Riassumendo, dei due approcci per calcolare l'integrale, il primo ha dato riultati corretti ma sembra più difficile da estendere a due dimensioni in modo efficente. Il secondo fin'ora non ha dato risultati, probabilmente per errore negli algoritmi.\\ \\
Un terzo approccio da esplorare è il cambio di variabili $Se^y=z$ a livello equazione. In tal caso si ottiene un equazione a coefficienti non costanti, ma la parte integrale potrebbe essere più semplice.
\\ \\
L'altro grande filone su cui concentrarsi è l'estensione in modo che sia dimension-independent.
\end{document}
